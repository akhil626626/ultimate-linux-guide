# DNS Cheat Sheet (GitHub-Ready)

> **DNS (Domain Name System)** = the Internetâ€™s phonebook. It translates names (e.g., `www.example.com`) to IPs (e.g., `93.184.216.34`).

---

## ðŸ”‘ Core Components

- **Stub Resolver** â€“ Your OS piece that apps call (`getaddrinfo`). Sends queries to a local/recursive resolver.
- **Recursive Resolver** â€“ ISP/enterprise/public resolver (e.g., **1.1.1.1**, **8.8.8.8**) that walks the hierarchy and **caches** results.
- **Authoritative Nameserver** â€“ Source of truth for a zone (e.g., `example.com`). Holds **A/AAAA/CNAME/MX/TXT/â€¦** records.
- **Root Servers** â€“ The DNS root (.) â€” point to TLD servers.
- **TLD Servers** â€“ `.com`, `.org`, `.net`, country TLDs, etc. Point to a domainâ€™s authoritative servers.

---

## ðŸ§­ How Resolution Works (Happy Path)

1. App asks **stub resolver**: â€œA record for `www.example.com`?â€  
2. **Recursive** checks **cache** â†’ if **hit**, return immediately.  
3. **Cache miss** â†’ Recursive asks:  
   1) a **Root** server â†’ â€œWho serves `.com`?â€  
   2) a **.com TLD** server â†’ â€œWhoâ€™s authoritative for `example.com`?â€  
   3) the **Authoritative** server â†’ â€œA for `www.example.com`?â€  
4. Authoritative replies with **IP** and **TTL** (time to live).  
5. Recursive **caches** for TTL and returns answer to client.

> **Caching** (including **negative caching** for NXDOMAIN) is why DNS changes take time to propagate.

---

## ðŸ§¾ Common Record Types

- **A / AAAA** â€“ Name â†’ IPv4 / IPv6.  
- **CNAME** â€“ Alias to another name (must not coexist with other data).  
- **NS** â€“ Delegation: which nameservers are authoritative for the zone.  
- **MX** â€“ Mail exchangers for a domain.  
- **TXT** â€“ Free text (SPF, DKIM, verification).  
- **SRV** â€“ Service locator (`_service._proto.name`).  
- **SOA** â€“ Zone metadata (serial, default timers).

---

## ðŸ†š Authoritative vs Recursive

- **Authoritative**: answers only for zones it hosts; **no recursion**.  
- **Recursive**: finds answers for clients and **caches**; validates DNSSEC if enabled.

---

## ðŸ” Security & Privacy (Quick)

- **DNSSEC** â€“ Cryptographic signatures for records â†’ authenticity (prevents cache poisoning). Look for `ad` flag in answers.  
- **DoT/DoH** â€“ DNS over TLS / HTTPS â†’ encrypts queries between client and recursive (privacy on-path).

---

## ðŸ§° Troubleshooting & Gotchas

- **Stale Cache** â€“ Wait for TTL or **flush** caches (client/recursive/CDN).  
- **Bad Delegation** â€“ NS/glue mismatch â†’ intermittent failures.  
- **Split-Horizon** â€“ Internal vs external answers by design.  
- **Firewall** â€“ UDP/TCP **53** blocked or fragmented responses dropped.  
- **CNAME chains** â€“ Last target must have **A/AAAA**; watch TTLs & loops.  
- **EDNS/Fragmentation/MTU** â€“ Large DNS responses may need TCP fallback.

---

## ðŸ§ª Useful Commands

```bash
# Basic lookups
dig A www.example.com
dig AAAA www.example.com +short
dig MX example.com +short

# Ask a specific resolver
dig @1.1.1.1 www.example.com

# Trace the full path (root -> TLD -> authoritative)
dig +trace www.example.com

# Show TTLs and DNSSEC validation flag (ad)
dig www.example.com +ttl +dnssec

# Find authoritative nameservers and zone metadata
dig NS example.com +short
dig SOA example.com

# Reverse lookup (PTR)
dig -x 93.184.216.34 +short

# systemd-resolved (Linux)
resolvectl status
sudo resolvectl flush-caches

# macOS flush
sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder

# Windows flush
ipconfig /flushdns
```

---

## ðŸ§  Mental Model

- **DNS = phonebook**, **TTL = cache time**, **Recursive = librarian**, **Authoritative = bookâ€™s author**.  
- Change the book? Everyone sees it **after their cached copy expires**.

---

## âœ… Quick Checklist for DNS Issues

- [ ] Is the **record** correct on the authoritative zone?  
- [ ] Do **NS** at the parent (TLD) match your zoneâ€™s **NS** (delegation OK)?  
- [ ] Are **TTL** values reasonable (not too high during migrations)?  
- [ ] Does the **recursive** you test use the same view (split-horizon)?  
- [ ] Any **firewall** filtering UDP/TCP **53** or dropping fragments?  
- [ ] If using **CNAME**, does the final target have **A/AAAA**?  
- [ ] For **mail**, do **MX** targets have A/AAAA and correct **SPF/DKIM/DMARC**?

